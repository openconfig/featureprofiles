name: Pull Request
on: [pull_request]
jobs:
  validate_oc_paths:
    name: Validate OpenConfig Paths
    runs-on: ubuntu-latest
    steps:
    - name: Install go
      uses: actions/setup-go@v2
      with:
        go-version: '1.17'
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Cache
      uses: actions/cache@v2
      with:
        path: |
          ~/go/pkg/mod
          ~/.cache/go-build
        key: ${{ runner.os }}-go-build-${{ hashFiles('**/go.sum') }}
    - name: Fetch Openconfig Models
      run: make openconfig_public
    - name: Validate Paths
      run: make validate_paths
  static_analysis:
    name: Static Analysis
    runs-on: ubuntu-latest
    steps:
    - name: Install go
      uses: actions/setup-go@v2
      with:
        go-version: '1.17'
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Cache
      uses: actions/cache@v2
      with:
        path: |
          ~/go/pkg/mod
          ~/.cache/go-build
        key: ${{ runner.os }}-go-build-${{ hashFiles('**/go.sum') }}
    - name: Go vet
      run: go vet ./...
    - name: Gofmt
      run: diff -u <(echo -n) <(gofmt -d -s .)
    - uses: dominikh/staticcheck-action@v1.1.0
      with:
        version: "2021.1.1"
        install-go: false
